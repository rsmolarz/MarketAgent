Implementation plan â€” EXACTLY what we add, in order

You asked to â€œget what we already have implemented.â€
So we proceed without breaking anything.

PHASE 1 â€” Wire Meta-Agent + PR comments (NOW)
1ï¸âƒ£ Where Meta-Supervisor runs

DO NOT put it in app.py.

Instead:

meta_supervisor/
â”œâ”€ supervisor.py        â† orchestrates evaluations
â”œâ”€ pr_comments.py       â† GitHub comment formatter
â”œâ”€ promotion.py         â† sandbox â†’ prod rules
â”œâ”€ retirement.py        â† agent / strategy kill logic
â””â”€ portfolio.py         â† attribution rollups

2ï¸âƒ£ How itâ€™s triggered (two ways)
A. Scheduled (safe default)

Add one scheduler job inside create_app() after scheduler init:

from meta_supervisor.supervisor import run_meta_supervisor

scheduler.scheduler.add_job(
    func=run_meta_supervisor,
    trigger=CronTrigger(hour="*/6"),
    id="meta_supervisor",
    replace_existing=True
)


ðŸ“ Insert right after:

scheduler = AgentScheduler(app)


This gives you:

rolling reviews

zero latency impact on agents

3ï¸âƒ£ GitHub PR Comment Template (exact)

Your Meta-Agent produces JSON â†’ we convert to this single canonical comment:

## ðŸ¤– Meta-Agent Review Report

**Overall Severity:** HIGH  
**Run ID:** {{run_id}}  
**Compared Against:** `main`

---

### ðŸ“Š Agent Health Summary
| Agent | Score | Alpha (30d) | Cost | Status |
|------|------|-------------|------|--------|
| {{agent}} | {{score}} | {{alpha}} | ${{cost}} | {{status}} |

---

### âš ï¸ Top Findings
{{#each findings}}
- **{{title}}**  
  Impact: {{impact}}  
  Evidence: {{evidence}}
{{/each}}

---

### âœ… Promotion Gate
- Behavioral score â‰¥ {{threshold}}
- Realized PnL positive
- No safety violations

**Result:** âŒ BLOCKED / âœ… APPROVED

---

### ðŸ”§ Recommended Actions
{{#each recommendations}}
- {{change}} ({{priority}})
{{/each}}

---

*Generated automatically by MarketAgents Meta-Supervisor*


This goes in:

meta_supervisor/pr_comments.py

PHASE 2 â€” Promotion Gates (sandbox â†’ prod)
Promotion happens ONLY when:
Gate	Requirement
Behavioral	â‰¥ 80
Realized PnL	> 0
Confidence decay	stable
Cost drift	within bounds
Kill-list	not flagged
Implementation
meta_supervisor/promotion.py

def should_promote(agent_metrics):
    return (
        agent_metrics.score >= 80 and
        agent_metrics.realized_pnl > 0 and
        agent_metrics.confidence_decay < 0.2 and
        not agent_metrics.kill_flag
    )


If passed:

auto-create promotion PR

tag [AUTO-PROMOTE]

human can still veto

PHASE 3 â€” Retirement scoring (agents + strategies)

You asked for strategy-class kills, not just agents.

New tables (models.py)
class StrategyClass(db.Model):
    name
    status  # active | deprecated | killed
    kill_reason

Retirement rules

Kill when any 2 of 4 are true:

Alpha < 0 for N periods

Confidence decay > threshold

Cost > value delivered

Repeated regime mismatch

Stored in:

meta_supervisor/retirement.py


This triggers:

scheduler stop

exclusion from capital allocation

permanent audit record

PHASE 4 â€” Realized PnL reconciliation (you already started this)

You already have:

alpha/events.jsonl

telemetry/events.jsonl

Missing piece (now added)
alpha/reconcile.py


Responsibilities:

join signal â†’ market price

compute realized PnL

feed back into:

confidence decay

promotion gates

failure forensics

This plugs into Meta-Supervisor automatically.

PHASE 5 â€” Capital allocation by agent
meta_supervisor/portfolio.py


Allocates capital via softmax:

weight = softmax(alpha * confidence / volatility)


Outputs:

per-agent capital %

portfolio-level attribution

LP-grade metrics

PHASE 6 â€” LP-grade performance emails (EMAIL only âœ”)

Since you switched off Slack/WhatsApp:

services/lp_report_service.py


Delivered via:

your existing email infra

same whitelist logic

daily / weekly cadence

Includes:

realized PnL

attribution

active vs killed strategies

promotion / demotion log