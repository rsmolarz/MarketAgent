{% extends "base.html" %}

{% block title %}Sign In - Market Inefficiency Platform{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-5 col-md-7">
            <div class="text-center mb-4">
                <i data-feather="trending-up" class="text-primary" style="width: 48px; height: 48px;"></i>
                <h3 class="mt-2 fw-bold">Sign In</h3>
                <p class="text-muted">Market Inefficiency Detection Platform</p>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}

            <div class="card shadow border-0">
                <div class="card-body p-4">
                    <style>
                        .oauth-btn {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 10px;
                            padding: 12px 16px;
                            border-radius: 8px;
                            font-size: 15px;
                            font-weight: 500;
                            text-decoration: none;
                            transition: opacity 0.15s, transform 0.1s;
                            border: 1px solid rgba(255,255,255,0.15);
                        }
                        .oauth-btn:hover { opacity: 0.9; transform: translateY(-1px); }
                        .oauth-btn:active { transform: translateY(0); }
                        .oauth-btn-google {
                            background: #fff;
                            color: #3c4043;
                            border: 1px solid #dadce0;
                        }
                        .oauth-btn-google:hover { background: #f7f8f8; color: #3c4043; }
                        .oauth-btn-apple {
                            background: #000;
                            color: #fff;
                            border-color: #333;
                        }
                        .oauth-btn-apple:hover { color: #fff; }
                        .oauth-btn-github {
                            background: #24292f;
                            color: #fff;
                            border-color: #444;
                        }
                        .oauth-btn-github:hover { color: #fff; }
                        .oauth-btn-facebook {
                            background: #1877F2;
                            color: #fff;
                            border: none;
                        }
                        .oauth-btn-facebook:hover { color: #fff; }
                    </style>
                    <div class="d-grid gap-2 mb-3">
                        {% if providers.get('google') %}
                        <a href="{{ url_for('oauth.start', provider='google') }}" class="oauth-btn oauth-btn-google">
                            <svg width="18" height="18" viewBox="0 0 48 48">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                            </svg>
                            Continue with Google
                        </a>
                        {% endif %}

                        {% if providers.get('apple') %}
                        <a href="{{ url_for('oauth.start', provider='apple') }}" class="oauth-btn oauth-btn-apple">
                            <svg width="16" height="20" viewBox="0 0 170 200" fill="#fff">
                                <path d="M150.37 130.25c-2.45 5.66-5.35 10.87-8.71 15.66-4.58 6.53-8.33 11.05-11.22 13.56-4.48 4.12-9.28 6.23-14.42 6.35-3.69 0-8.14-1.05-13.32-3.18-5.2-2.12-9.97-3.17-14.34-3.17-4.58 0-9.49 1.05-14.75 3.17-5.27 2.13-9.52 3.24-12.78 3.35-4.93.21-9.84-1.96-14.75-6.52-3.13-2.73-7.04-7.41-11.75-14.04-5.03-7.08-9.16-15.29-12.41-24.65-3.47-10.11-5.21-19.9-5.21-29.38 0-10.87 2.35-20.24 7.04-28.08 3.69-6.31 8.6-11.3 14.75-14.95 6.15-3.66 12.79-5.52 19.96-5.72 3.91 0 9.05 1.21 15.43 3.59 6.36 2.39 10.45 3.6 12.25 3.6 1.35 0 5.91-1.42 13.63-4.23 7.3-2.61 13.46-3.69 18.51-3.27 13.68 1.1 23.95 6.5 30.78 16.23-12.24 7.42-18.31 17.82-18.2 31.16.11 10.39 3.88 19.04 11.28 25.9 3.35 3.18 7.1 5.64 11.26 7.38-.9 2.62-1.86 5.13-2.86 7.54zM119.11 7.24c0 8.15-2.97 15.75-8.9 22.77-7.16 8.39-15.82 13.23-25.21 12.47-.12-.97-.19-2-.19-3.07 0-7.82 3.4-16.19 9.44-23.04 3.01-3.46 6.84-6.33 11.49-8.63 4.64-2.27 9.03-3.52 13.16-3.74.12 1.1.21 2.2.21 3.24z"/>
                            </svg>
                            Continue with Apple
                        </a>
                        {% endif %}

                        {% if providers.get('github') %}
                        <a href="{{ url_for('oauth.start', provider='github') }}" class="oauth-btn oauth-btn-github">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff">
                                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                            </svg>
                            Continue with GitHub
                        </a>
                        {% endif %}

                        {% if providers.get('facebook') %}
                        <a href="{{ url_for('oauth.start', provider='facebook') }}" class="oauth-btn oauth-btn-facebook">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="#fff">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                            Continue with Facebook
                        </a>
                        {% endif %}
                    </div>

                    <div class="position-relative my-4">
                        <hr>
                        <span class="position-absolute top-50 start-50 translate-middle bg-dark px-3 text-muted small">or sign in with email</span>
                    </div>

                    <ul class="nav nav-tabs nav-fill mb-3" id="emailAuthTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="signin-tab" data-bs-toggle="tab" data-bs-target="#signin-panel" type="button" role="tab">Sign In</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register-panel" type="button" role="tab">Register</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="emailAuthTabContent">
                        <div class="tab-pane fade show active" id="signin-panel" role="tabpanel">
                            <form method="POST" action="{{ url_for('oauth.email_login') }}">
                                <div class="mb-3">
                                    <label for="login-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="login-email" name="email" required placeholder="you@example.com">
                                </div>
                                <div class="mb-3">
                                    <label for="login-password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="login-password" name="password" required placeholder="Your password">
                                </div>
                                <button type="submit" class="btn btn-primary w-100 btn-lg">
                                    <i data-feather="log-in" class="me-2" style="width:18px;height:18px;"></i>Sign In
                                </button>
                            </form>
                        </div>

                        <div class="tab-pane fade" id="register-panel" role="tabpanel">
                            <form method="POST" action="{{ url_for('oauth.email_register') }}">
                                <div class="row mb-3">
                                    <div class="col">
                                        <label for="reg-first" class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="reg-first" name="first_name" placeholder="First">
                                    </div>
                                    <div class="col">
                                        <label for="reg-last" class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="reg-last" name="last_name" placeholder="Last">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="reg-email" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="reg-email" name="email" required placeholder="you@example.com">
                                </div>
                                <div class="mb-3">
                                    <label for="reg-password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="reg-password" name="password" required minlength="8" placeholder="Min 8 characters">
                                </div>
                                <button type="submit" class="btn btn-success w-100 btn-lg">
                                    <i data-feather="user-plus" class="me-2" style="width:18px;height:18px;"></i>Create Account
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <p class="text-center text-muted small mt-3">
                Access is restricted to approved users only.
                <br><a href="{{ url_for('privacy') }}" class="text-muted">Privacy Policy</a>
            </p>
        </div>
    </div>
</div>
{% endblock %}
