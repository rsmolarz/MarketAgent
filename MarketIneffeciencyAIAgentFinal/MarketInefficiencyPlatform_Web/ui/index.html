
<!DOCTYPE html>
<html>
<head>
  <title>ðŸ“Š Market Inefficiency Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body style="font-family:sans-serif;padding:20px">
  <h1>ðŸ“ˆ Market Inefficiency Agent Dashboard</h1>
  <div id="chart" style="width:100%;height:400px"></div>
  <div id="scheduler" style="margin-top:40px;padding:20px;background:#f5f5f5;border:1px solid #ccc"></div>

<script>
async function fetchFindings() {
  const res = await fetch('/findings');
  const data = await res.json();
  return data.recent || [];
}

function renderChart(findings) {
  const times = findings.map(f => f.timestamp);
  const titles = findings.map(f => f.title);
  const types = findings.map(f => f.agent);
  const severity = findings.map(f => f.severity === 'high' ? 3 : f.severity === 'medium' ? 2 : 1);

  const trace = {
    x: times,
    y: severity,
    text: titles,
    mode: 'markers',
    marker: {
      size: 12,
      color: severity,
      colorscale: 'RdYlGn',
      showscale: true,
    },
    type: 'scatter'
  };

  Plotly.newPlot('chart', [trace], {
    title: 'Agent Findings (Severity Timeline)',
    xaxis: { title: 'Time' },
    yaxis: { title: 'Severity (1=Low, 3=High)' }
  });
}

async function loadDashboard() {
  const findings = await fetchFindings();
  renderChart(findings);
  loadSchedules();
}

async function toggleSchedule(agent, action) {
  const res = await fetch('/schedule', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ agent, action, interval: 60 })
  });
  const data = await res.json();
  alert(data.status || data.error);
  loadSchedules();
}

async function loadSchedules() {
  const res = await fetch('/schedule');
  const data = await res.json();
  const active = data.active || [];
  const agents = ["AltDataSignalAgent", "MacroWatcherAgent", "CommoditiesWatcherAgent",
                  "BondStressAgent", "RetailSentimentAgent", "EquityMomentumAgent",
                  "InsiderTradingAlertAgent", "OptionsSkewAgent", "SupplyChainDisruptionAgent",
                  "GeopoliticalRiskAgent", "PatentSurgeAgent"];
  let html = "<h3>ðŸ“… Agent Scheduler</h3><ul>";
  for (const a of agents) {
    const isOn = active.includes(a);
    html += `<li><b>${a}</b> â€” <button onclick="toggleSchedule('${a}', '${isOn ? 'remove' : 'add'}')">${isOn ? 'Stop' : 'Start'}</button></li>`;
  }
  html += "</ul>";
  document.getElementById('scheduler').innerHTML = html;
}

window.onload = loadDashboard;
</script>
</body>
</html>
